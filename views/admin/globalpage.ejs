<!DOCTYPE html>
<html lang="en">
  <head>
    <script>
    function getSocialMediaIconClass(fieldName) {
  switch (fieldName.toLowerCase()) {
    case 'linkedin':
      return 'fa fa-linkedin';
    case 'instagram':
      return 'fa fa-instagram';
    // Add more cases for other social media icons
    default:
      return 'fa-default'; // Replace with a default icon class
  }
}
  </script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link rel="stylesheet" href="/public/assets/admin/css/style.css">
    <title>eCardify</title>
    <style>
    @import url("https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;600;700;800;900&display=swap");
    </style>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  </head>

  <body>
    <div class="wrapper row">
      <div class="left_side">
        <aside class="aside_section aside">
          <div class="profile_details">
            <img src="data:image/<%= pageData[0].imageSize %>;base64, <%= pageData[0].image %>" alt="Your Image Alt Text" style="height:<%=pageData[0].imageSize%>px;">

            <p class="person_name">
                <span style="color: <%= pageData[0].basicInformationFields[0].textColor %>; font-style: <%= pageData[0].basicInformationFields[0].textStyle %>; font-size: <%= pageData[0].basicInformationFields[0].textSize %>px;">
                  <%= pageData[0].basicInformationFields[0].value %>
                </span>
                &nbsp;<br>
                <span style="color: <%= pageData[0].basicInformationFields[1].textColor %>; font-style: <%= pageData[0].basicInformationFields[1].textStyle %>; font-size: <%= pageData[0].basicInformationFields[1].textSize %>px;">
                  <%= pageData[0].basicInformationFields[1].value %>
                </span>
              </p>
              
              <div>
                <button class="button" id="saveContactButton" style="background-color: <%= pageData[0].additionalButtons[0].buttonColor %>; font-style:<%= pageData[0].additionalButtons[0].textStyle%>;font-size:<%= pageData[0].additionalButtons[0].buttonSize%>px;"><%= pageData[0].additionalButtons[0].value %></button>
                <button class="button" id="shareButton" style="background-color: <%= pageData[0].additionalButtons[1].buttonColor %>; font-style:<%= pageData[0].additionalButtons[1].textStyle%>;font-size:<%= pageData[0].additionalButtons[1].buttonSize%>px;"><%= pageData[0].additionalButtons[1].value %></button>
              </div>
          </div>
          <div class="social_details">
            <table>
                <% pageData[0].contactInfoFields.forEach(contact => { %>
                    <tr>
                      <td><i class="material-icons"><%= contact.icon %></i></td>
                        <td style="font-size: <%= contact.textSize%>px; font-style: <%=contact.textStyle%>; color:<%= contact.textColor%>;"><%= contact.value %></td>
                    </tr>
                <% }); %>
            </table>
            <tr>
              <% pageData[0].socialMediaFields.forEach(social => { %>
                <a href="https:<%= social.value %>" class="fa fa-instagram"></a>
              <% }); %>                
              </tr>
        </div>
        </aside>
      </div>

      <div class="right_side">
        <section class="main">
          <div class="first">
            <div class="text-details">
              <h4>ABOUT</h4>
              <p style="color: <%= pageData[0].basicInformationFields[2].textColor %>; font-style: <%= pageData[0].basicInformationFields[2].textStyle %>; font-size: <%= pageData[0].basicInformationFields[2].textSize %>px;">
                <%=pageData[0].basicInformationFields[2].value%>
              </p>
              <h4>Professional Details</h4>
              <p style="color: <%= pageData[0].basicInformationFields[3].textColor %>; font-style: <%= pageData[0].basicInformationFields[3].textStyle %>; font-size: <%= pageData[0].basicInformationFields[3].textSize %>px;">
                <%=pageData[0].basicInformationFields[3].value%>
              </p>
            </div>
         
            <div class="card-detials">
              <h4>Achievements</h4>
              <div class="cards mb-3">
                <h4>I AM GOWTHAM</h4>
              </div>
              <div class="cards mb-3"></div>
            </div>
          </div>

          <!-- <div class="second">
            <h2 class="quotation ml-4">Achievements</h2>
            <div
              style="
                display: flex;
                column-gap: 1rem;
                align-items: center;
                justify-content: space-evenly;
                margin: 1rem;
              "
            >
              <div class="cards"></div>
              <div class="cards"></div>
              <div class="cards"></div>
            </div>
          </div> -->

          <div class="third">
             <div class="analytics">
              <p><%=pageData[0].saves %> save</p>
              <p><%=pageData[0].shares %> shares</p>
              <p><%=pageData[0].views %> views</p>
            </div>
            <div class="msg">
              <label>Write Message...</label>
              <div class="input-icons">
                <input class="input-field" type="text" id="messageInput" placeholder="Enter Message" />
                <i class="fa fa-paper-plane" style="color: #767676" onclick="sendMessage()"> </i>
              </div>
            </div>
            </div>
          
        </section>

        <footer class="footer">
          <p>Powered by @eCardify</p>
        </footer>
      </div>
    </div>
    <script>
      // JavaScript to handle the button click event
      document.getElementById('saveContactButton').addEventListener('click', function() {
        // Construct the contact information
        var contactInfo = {
          name: '<%= pageData[0].basicInformationFields[0].value %>',
          phone: '<%= pageData[0].contactInfoFields[0].value %>',
          mail:  '<%= pageData[0].contactInfoFields[1].value %>',
          // Add other contact fields as needed
        };
    
        // Convert the contact information to a vCard format
        var vCardData = 'BEGIN:VCARD\r\n' +
                        'VERSION:3.0\r\n' +
                        'FN:' + contactInfo.name + '\r\n' +
                        'TEL:' + contactInfo.phone + '\r\n' +
                        'EMAIL:' + contactInfo.mail + '\r\n' +
                        // Add other vCard fields as needed
                        'END:VCARD';
    
        // Create a Blob from the vCard data
        var blob = new Blob([vCardData], { type: 'text/vcard' });
    
        // Create a download link and trigger a click event
        var link = document.createElement('a');
        link.href = window.URL.createObjectURL(blob);
        link.download = 'contact.vcf';
        link.click();
        
        
        fetch('/update-saves', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                pageId: '<%= pageData[0]._id %>',
            }),
        })
        .then(response => response.json())
        .then(data => {
            // Handle the response if needed
            console.log('Saves count updated successfully');
            location.reload();
        })
        .catch(error => {
            console.error('Error updating saves count:', error);
        });
      });
    </script>

<script>
  document.getElementById('shareButton').addEventListener('click', function() {
      // Check if the Web Share API is supported
      if (navigator.share) {
          navigator.share({
              title: document.title,
              url: window.location.href
          })
          .then(() => console.log('Shared successfully'))
          .catch((error) => console.error('Error sharing:', error));
      } else {
          // Fallback for browsers that do not support Web Share API
          alert('Web Share API is not supported in this browser. You can manually copy the URL.');
      }

      fetch('/update-shares', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                pageId: '<%= pageData[0]._id %>',
            }),
        })
        .then(response => response.json())
        .then(data => {
            // Handle the response if needed
            console.log('Shares count updated successfully');
            location.reload();
        })
        .catch(error => {
            console.error('Error updating shares count:', error);
        });
  });
  </script>

<script>
  // Add this script to your HTML file
  document.addEventListener('DOMContentLoaded', function () {
      // Update the views count in the database
      fetch('/update-views', {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json',
          },
          body: JSON.stringify({
              pageId: '<%= pageData[0]._id %>',
          }),
      })
      .then(response => response.json())
      .then(data => {
          // Handle the response if needed
          console.log('Views count updated successfully');
          location.reload();
      })
      .catch(error => {
          console.error('Error updating views count:', error);
      });
  });
</script>

<script>
 function sendMessage() {
  var message = document.getElementById('messageInput').value;
  var documentId = '<%= pageData[0]._id %>';

  fetch('/send-message', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({message,documentId }),
  })
  .then(response => {
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    return response.json();
  })
  .then(data => {
    // Handle the response if needed
    console.log(data);
  })
  .catch(error => {
    console.error('Error sending message:', error);
  });
}

</script>
    <script
      src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
      integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
      integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
      integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"
      integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+"
      crossorigin="anonymous"
    ></script>
  </body>
</html>